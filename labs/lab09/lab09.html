<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Lab No. 9: Processes and Shell Script Basics &#8212; CS210 Introduction to Unix  documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link href="https://fonts.googleapis.com/css?family=Lusitana|Roboto|Roboto+Mono" rel="stylesheet">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          CS210 Introduction to Unix</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../syllabus.html">CS210 Introduction to Unix - Spring 2020</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conv/conv.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schedule.html">Course Schedule and Materials</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Lab No. 9: Processes and Shell Script Basics</a><ul>
<li><a class="reference internal" href="#processes">Processes</a></li>
<li><a class="reference internal" href="#the-environment">The environment</a></li>
<li><a class="reference internal" href="#shell-scripts">Shell Scripts</a><ul>
<li><a class="reference internal" href="#script-arguments">Script Arguments</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../../_sources/labs/lab09/lab09.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="lab-no-9-processes-and-shell-script-basics">
<h1>Lab No. 9: Processes and Shell Script Basics<a class="headerlink" href="#lab-no-9-processes-and-shell-script-basics" title="Permalink to this headline">¶</a></h1>
<p>After completing this lab, students will be able to:</p>
<ul class="simple">
<li>understand how processes are created in a Linux system</li>
<li>list processes in a Linux system</li>
<li>describe the purpose of some common environment variables</li>
<li>create simple shell scripts</li>
</ul>
<div class="section" id="processes">
<h2>Processes<a class="headerlink" href="#processes" title="Permalink to this headline">¶</a></h2>
<p>A process is simply a running instance of a program.
A program is composed of instructions that are executed by the CPU.
When a process starts, its instructions are stored in memory, and also, memory is allocated for the process.
The process has “safe access” to the chunk of memory that it gets allocated, which essentially means that other processes would not be able to modify the memory allocated to the process, and also that the process would not modify memory allocated to other processes.</p>
<p>Chapter 10 of TLC covers processes. Please go ahead and read that chapter in its entirety, making sure that you have understood all the examples.
The example in the section “Controlling Processes” which executes the <code class="docutils literal"><span class="pre">xlogo</span></code> command will not work, but instead use the <code class="docutils literal"><span class="pre">sleep</span> <span class="pre">1000</span></code> command.
Consult the man pages of <code class="docutils literal"><span class="pre">sleep</span></code> so you can understand what is the purpose of this command (you can probably make a pretty good guess by its name).
Also, the <code class="docutils literal"><span class="pre">xload</span></code> command will not work in <strong>blue</strong>.
So, go ahead and read Chapter 10 and once you are done come back and continue with the next paragraph in this document.</p>
<p>OK, so you are back from Chapter 10.
There are a few things that need some clarification.
One thing you might be wondering is: <strong>How are processes created?</strong></p>
<p>Essentially, every process is created by another process.
As explained in the book, when a Linux system boots, there is one special process that starts first, and that is known as the <strong>init</strong> process, and it is assigned a process ID of 1, so it is also called <strong>PID1</strong>.
Every other process is a child of PID1.
You can picture now that (just like the filesystem) the processes in a Linux system are organized in a tree structure.
When a new process is created, the operating system makes a copy of the parent process (in a process called <em>forking</em>) and then the specific command is <strong>executed</strong> by reading the instructions of the command and loading it into memory, and it gets a process id assigned to it. This is what’s known as the <strong>fork-and-exec</strong> mechanism.</p>
<p>Let’s see some examples (please make sure you are logged in <code class="docutils literal"><span class="pre">blue.cs.sonoma.edu</span></code>:</p>
<p>By now, you should know that the <code class="docutils literal"><span class="pre">ps</span></code> command is used to list processes. In the following example, you can see the processes your user is running:</p>
<pre class="literal-block">
[user&#64;blue ~]$ <strong class="command">ps f</strong>
  PID TTY      STAT   TIME COMMAND
15853 pts/0    Ss     0:00 -bash
21441 pts/0    R+     0:00  \_ ps f
</pre>
<p>You can see that your current shell (<code class="docutils literal"><span class="pre">bash</span></code>) is the parent process of the <code class="docutils literal"><span class="pre">ps</span> <span class="pre">f</span></code> command.
Also, notice that each process thas a “PID” or Process ID associated with it. Of, course, the process ID numbers <strong>will</strong> differ from what you see here.
So just to set the record straigh, in that example process <code class="docutils literal"><span class="pre">15853</span></code> is the parent process of process <code class="docutils literal"><span class="pre">21441</span></code>, and process <code class="docutils literal"><span class="pre">21441</span></code> is a child process of process <code class="docutils literal"><span class="pre">21441</span></code>. One thing that should be obvious at this point is that one process can have many child processes, and one child process can only have one parent.</p>
<p>The <code class="docutils literal"><span class="pre">BASHPID</span></code> variable stores the value of the current shell process ID:</p>
<pre class="literal-block">
[user&#64;blue ~]$ <strong class="command">echo $BASHPID</strong>
15853
</pre>
<p>Let’s try now to create some child processes.
You can start a new shell session within the current shell session:</p>
<pre class="literal-block">
[user&#64;blue ~]$ <strong class="command">bash</strong>
[user&#64;blue ~]$ <strong class="command">echo $BASHPID</strong>
40791
[user&#64;blue ~]$ <strong class="command">ps f</strong>
  PID TTY      STAT   TIME COMMAND
15853 pts/0    Ss     0:00 -bash
40791 pts/0    S      0:00  \_ bash
39492 pts/0    R+     0:00      \_ ps f
</pre>
<p>Notice how <code class="docutils literal"><span class="pre">$BASHPID</span></code> prints the process ID of the second instance of <code class="docutils literal"><span class="pre">bash</span></code>, and that PID 39492 (<code class="docutils literal"><span class="pre">ps</span> <span class="pre">f</span></code>) is a child of the new shell with PID 40791, instead of the shell we were on before (PID 15853).
You can see this with more detail if your run <code class="docutils literal"><span class="pre">ps</span> <span class="pre">jf</span></code> which includes a column with the parent process ID (PPID):</p>
<pre class="literal-block">
[user&#64;blue ~]$ <strong class="command">ps jf</strong>
 PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND
15852 15853 15853 15853 pts/0    40855 Ss    1135   0:00 -bash
15853 40791 40791 15853 pts/0    40855 S     1135   0:00  \_ bash
40791 40855 40855 15853 pts/0    40855 R+    1135   0:00      \_ ps jf
</pre>
<p>At this point, if you type the <code class="docutils literal"><span class="pre">exit</span></code> command (once) you will terminate the second shell and you will be back at the original shell.</p>
</div>
<div class="section" id="the-environment">
<h2>The environment<a class="headerlink" href="#the-environment" title="Permalink to this headline">¶</a></h2>
<p>Recall how on Lab 04 we learned about environment variables.
Before learning how to write Shell scripts, we need to understand how the environment is set and how it can be altered.
From your text book read Chapter 11, from pages 128 until page 134. Pay special attention to the section where the <code class="docutils literal"><span class="pre">PATH</span></code> environment variable is explained.
Once you have read that part come back to this document.</p>
</div>
<div class="section" id="shell-scripts">
<h2>Shell Scripts<a class="headerlink" href="#shell-scripts" title="Permalink to this headline">¶</a></h2>
<p>A shell script is basically a file that contains a series of commands.
Shell scripts are plain text files, so they can be created with any text editor.
They can be even conveniently created from the command line if they are simple enough.</p>
<p>For this part of the Lab you need to read (and execute all examples) from Chapter 24 of TLC. Once you are done, come back to this document.</p>
<div class="section" id="script-arguments">
<h3>Script Arguments<a class="headerlink" href="#script-arguments" title="Permalink to this headline">¶</a></h3>
<p>Shell scripts can use variables in many forms.
A variable is a “placeholder” for a value that can change (hence the name).
Shell scripts accept postional parameters, and they are accessible within the script using the a dollar sign (<code class="docutils literal"><span class="pre">$</span></code>) and a number that corresponds to the argument position.</p>
<p>Create a script called <code class="docutils literal"><span class="pre">args.sh</span></code> with the following contents (and dont forget to ass the execute permissions)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#!/bin/bash

# This is my first shell script with arguments
echo &quot;The first argument you entered is: &quot; $1
</pre></div>
</div>
<p>Now try running the script:</p>
<pre class="literal-block">
[user&#64;blue ~]$ <strong class="command">./args.sh Linux</strong>
The first argument you entered is: Linux
</pre>
<p>If you need to pass an argument that contains whitespace, you need to use quotes around the text.  Explore running that script with different types of arguments.</p>
<div class="worksheet admonition">
<p class="first admonition-title">Lab Submission</p>
<p>You are asked to create several basic scripts at each step.  You <em>need to include</em> each one of these in your lab submission.</p>
<p>Consider the following directory tree:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vehicles
│
├── public_bicycles
├── public_cars
├── public_planes
├── bicycles
├── cars
└── planes
</pre></div>
</div>
<ol class="arabic simple">
<li>Create a shell script that will generate that directory structure. Name this script <code class="docutils literal"><span class="pre">makedirs.sh</span></code> and include this script in your submission.</li>
<li>Create a new script called <code class="docutils literal"><span class="pre">securedirs.sh</span></code> that will modify permissions in the previous tree structure so:</li>
</ol>
<ul class="simple">
<li>any user can read/write files into directories that have the  <em>public</em> prefix (i.e. <code class="docutils literal"><span class="pre">public_bicycles</span></code>, <code class="docutils literal"><span class="pre">public_cars</span></code> and <code class="docutils literal"><span class="pre">public_planes</span></code>)</li>
<li>no user other than the owner can create files, or list the contents of the <em>non public</em> directories (i.e <code class="docutils literal"><span class="pre">bicycles</span></code>, <code class="docutils literal"><span class="pre">cars</span></code> and <code class="docutils literal"><span class="pre">planes</span></code>)</li>
<li>any user can execute the files in the <em>non public</em> directories</li>
</ul>
<ol class="last arabic simple" start="3">
<li>Create a new script called <code class="docutils literal"><span class="pre">movefiles.sh</span></code> that will print to the terminal any file added into the  <em>public</em> directories and will move them to their corresponding <em>non public</em> directory. If a file already exists on the <em>non public</em> directory, your script needs to overwrite the file without asking for confirmation.  Also, your script should not produce any error messages in case there are no files that need to be moved (hint: <code class="docutils literal"><span class="pre">/dev/null</span></code> is your friend when you want to get rid of error messages).</li>
<li>Extract the archive <code class="docutils literal"><span class="pre">~jmora/lab09/texts.tar.gz</span></code> into your current directory. This expands to a folder called <code class="docutils literal"><span class="pre">texts</span></code> with some text files on it.  Create a new script called <code class="docutils literal"><span class="pre">findwords.sh</span></code> that will take the first argument passed to the script and will perform a search on the files that were extracted (contained in the <code class="docutils literal"><span class="pre">texts</span></code> folder), and will print the number of lines were the input word appears.</li>
</ol>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>